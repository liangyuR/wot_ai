<!-- 2c1e2e75-d3c4-4e87-bd74-2bd3096b966e 9aa553ae-593f-4b96-bb1f-68e6990ac1ca -->
# 连续自适应移动控制（低频规划 + 防卡顿）

## 目标

- 规划成功后保持持续移动，不再一段段地走停
- 只在首次或间隔数秒后重新规划，其余时间沿着既有路径前进
- 不依赖箭头角度，通过当前位置与路径目标点的矢量来转向
- 通过持续检测小地图位置来自适应方向
- 当坦克疑似卡住或偏离路径时自动触发重新规划/解卡

## 实现步骤

### 1. ControlService：支持按键保持

**文件**: `wot_ai/game_modules/navigation/service/control_service.py`

- 添加 `PressKey`、`ReleaseKey`、`IsKeyPressed` 辅助方法
- 添加 `StartForward()`、`StopForward()` 方法实现“持续按下/释放 W`
- 维护内部状态，避免重复按压
- 预留 `StartLeft/Right/Backward`（后续用于避障/解卡）

### 2. NavigationExecutor：封装持续移动接口

**文件**: `wot_ai/game_modules/navigation/core/navigation_executor.py`

- 添加 `EnsureMovingForward()` 调用 ControlService.StartForward()
- 添加 `StopMoving()` 调用 ControlService.StopForward()
- 保留 `RotateToward()` 用于持续朝向调整
- 维护 `target_point_offset`、`current_target_idx`，方便路径消费

### 3. main.py：路径维护、低频规划与自适应控制

**文件**: `wot_ai/game_modules/main.py`

- 记录 `current_path_`、`current_target_idx_`、`last_plan_time_`、`last_pos_`
- 仅在以下情况重新规划：
- 首次运行
- 距离上次规划超过阈值（例如 3 秒）
- 路径为空或接近终点
- 连续多帧检测到位移极小（疑似卡住）
- 控制逻辑：
- 根据 `target_point_offset` 选择路径上的远端目标点
- 以当前 self_pos 与目标点计算方向误差，调用 `RotateToward()` 逐帧调整
- 调用 `EnsureMovingForward()` 保持 W 按下，使移动连续
- 当路径耗尽或需要停止时，调用 `StopMoving()` 释放按键

### 4. 解卡/安全机制

- 若连续若干帧内 self_pos 位移低于阈值：
- 调用 `StopMoving()`
- 立即触发重新规划
- 可选：后续扩展为自动倒车/左右调整
- 在异常/退出流程 (`Stop()`、异常分支) 中统一调用 `StopMoving()` 释放按键

## 注意

- 所有新方法需加日志以便调试
- 发生异常或程序停止时确保释放按键，避免卡住输入设备

### To-dos

- [ ] 创建 wot_ai/game_modules/main.py 主程序文件
- [ ] 实现服务初始化：CaptureService, MinimapAnchorDetector, MinimapDetector, AStarPlanner, ControlService, NavigationExecutor
- [ ] 实现小地图区域检测和TransparentOverlay初始化（位置和尺寸必须与小地图完全重合）