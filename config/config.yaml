# 导航系统配置文件模板
# 复制此文件为 config.yaml 并填写实际值
# 这里的路径全部相对于 main_window.py 文件所在目录或 EXE 所在目录

# YOLO模型配置
model:
  path: "resource/model/best_m_detect.pt"  # YOLO模型文件路径（必需）
  conf_threshold: 0.65  # 置信度阈值 (0.0-1.0)
  iou_threshold: 0.55  # IoU阈值 (0.0-1.0)

# 小地图配置
minimap:
  size: [1200, 1200]  # 小地图尺寸 [width, height]
  max_size: 1200  # 小地图最大尺寸

# 掩码配置（可选）
mask:
  inflation_radius_px: 2  # 障碍膨胀半径（像素）
  cost_alpha: 2  # 代价图权重

# 栅格配置
grid:
  size: [256, 256]  # 栅格尺寸 [width, height]

# 路径规划、控制、角度检测配置
#
# 本节涵盖路径生成（A*平滑、采样、后处理）、动作控制（容忍阈值、速度与滞回策略），以及 minimap 箭头角度检测参数。
# 范围包括 path_planning（路径算法配置）、control（运动执行与错误检测）、angle_detection（箭头检测限制），如需实验/调参时可重点关注。

path_planning:                # 路径规划相关参数
  enable_astar_smoothing: true                # 开启A*内部平滑（可去除锯齿，对窄道友好，需配合简化阈值防止过拟合）
  astar_smooth_weight: 0.3                    # A*平滑权重 (0.0-1.0)，0.3为适中，能兼顾细节与路径平顺
  post_smoothing_method: "catmull_rom"        # 路径后处理方法: "catmull_rom"（平滑曲线）或 "los"（线段）
  simplify_method: "rdp"                      # 路径简化方法: RDP，可减少 waypoint 数提升效率
  simplify_threshold: 3                       # 简化阈值(px)，<5更适合保持窄弯信息
  num_points_per_segment: 8                   # CatmullRom采样点数，平滑度和点数折中
  curvature_threshold_deg: 30.0               # 曲率阈值(°)，大于此为急弯，可限制过度平滑
  check_curvature: true                       # 启用曲率检查，窄路必开，防止平滑导致出道
  enable_los_post_smoothing: true             # 仅"los"后处理用（catmull_rom保留占位，为兼容未来切换）

control:                       # 运动控制及状态检测参数

  # === 状态与基本判定 ===
  goal_arrival_threshold: 15.0                # 判定到达目标区域的像素距离阈值，15px适合路宽12~15px的场景
  path_deviation_tolerance: 3                 # 路径偏离容忍度(px)，决定内走廊宽度范围
  stuck_threshold: 5.0                        # 坐标移动小于该值视作卡顿(单帧/多帧)
  stuck_frames_threshold: 180                 # 连续多少帧内满足卡顿条件才判定为真正“卡死”(20Hz下约9秒)
  debug_log_interval: 30                      # 控制日志输出间隔（帧）

  # === MovementController ===
  # 前进/转向/速度控制与直行模式
  angle_dead_zone_deg: 3.0                    # 小于该角度偏差不修正方向，有效抑制检测抖动
  angle_slow_turn_deg: 12.0                   # 小角度(<12°)用慢转方式调整，提升精度
  distance_stop_threshold: 6.0                # 距 waypoint <6px 时不再前进，避免抖动和重复切换
  slow_down_distance: 10.0                    # 小于此距离提前减速，防止冲过目标
  max_forward_speed: 1.0                      # 最大归一化前进速度(0~1)
  min_forward_factor: 0.3                     # 大角度转向时的最小速度占比，保证拐弯时不断流
  large_angle_threshold_deg: 40.0             # 认为“大转弯”的角度阈值
  large_angle_speed_reduction: 0.3            # 大角度转向时前进速度降幅(比例)
  corridor_ref_width: 8                       # 横向误差归一
  edge_speed_reduction: 0.85                  # 走廊边缘速度缩放
  recenter_speed_reduction: 0.6               # 纠偏模式速度缩放

  # 直行模式判定（区分角度/横向阈值）
  straight_angle_enter_deg: 2                 # 直行模式进入角度阈值（度）
  straight_angle_exit_deg: 4                  # 直行模式退出角度阈值（度）
  straight_lat_enter: 2                       # 直行模式进入横向阈值（像素）
  straight_lat_exit: 5                        # 直行模式退出横向阈值（像素）

  # === MoveExecutor ===
  # 指令平滑/滞回（主）
  smoothing_alpha: 0.5                        # 平滑滤波系数，与主 smoothing_alpha 对齐即可，先进先用
  turn_deadzone: 0.06                         # 转向死区，大于此值才输出转向
  min_hold_time_ms: 6.0                     # 最小按键保持时间（毫秒），小于该值按一次也有效
  forward_hysteresis_on: 0.35                 # 前进开启滞回阈值，建议与主值保持一致
  forward_hysteresis_off: 0.08                # 前进关闭滞回阈值，抑制抖动

  # === PathFollower ===
  max_lateral_error: 10.0                     # 最大横向偏差容忍，超过即触发recenter
  lookahead_distance: 20.0                    # 路径跟踪前瞻距离(px)，影响曲线走形
  waypoint_switch_radius: 6.0                 # 到达 waypoint 触发切换的判定半径


angle_detection:               # 小地图角度检测限制
  smoothing_alpha: 0.9                          # 角度检测平滑系数(0=全历史, 1=全新值)
  max_step_deg: 50.0                            # 单帧允许的最大角度跳变限制(°)
  min_area_ratio: 0.2                           # 检测区域需占小地图面积的最小比例
  max_area_ratio: 0.9                           # 检测区域允许的最大面积比例
  min_aspect_ratio: 0.3                         # 箭头最小宽高比（排除细长异常）
  max_aspect_ratio: 3.0                         # 箭头最大宽高比（排除过于扁平异常）

# 车辆配置
vehicle:
  screenshot_dir: "resource/vehicle_screenshots"  # 车辆截图目录（相对路径基于程序目录）

# UI配置
ui:
  overlay_fps: 30  # 覆盖层FPS
  overlay_alpha: 180  # 覆盖层透明度 (0-255)
  enable: true  # 是否启用调试视图

# 屏幕捕获配置
monitor_index: 1  # 屏幕捕获监视器索引
