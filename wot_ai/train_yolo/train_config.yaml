# 小地图检测模型训练配置

# 模型配置
model:
  # 基础模型名称（yolo11n.pt, yolo11s.pt, yolo11m.pt, yolo11l.pt, yolo11x.pt）
  name: "yolo11m-seg.pt"
  # 图像尺寸（640 比 512 保留更多像素细节，适合小目标检测）
  imgsz: 640
  # 设备（cpu, 0, 1等）
  device: "0"

# 模型名称，图像路径（文件夹下的所有图片），输出路径示例
test:
  model: "data/models/training/minimap/exp_minimap4/weights/best.pt"
  image_dir: "data/minimap_images/"
  output_dir: "data/models/training/minimap/exp_minimap4/val_result"
  conf_threshold: 0.75   # 置信度阈值（放宽以观察更多检测结果）
  iou_threshold: 0.5     # IoU 阈值（用于 NMS）
  show_result: false     # 是否显示结果窗口（批量处理时建议设为 false）

# 训练参数
training:
  # 训练轮数
  epochs: 200
  # 批次大小（减小批次提高梯度稳定性）
  batch: 8
  # 工作线程数
  workers: 8
  # 是否启用数据增强
  augment: true
  # 优化器（AdamW 比 SGD 在小样本下收敛更平稳）
  optimizer: "AdamW"
  # 初始学习率
  lr0: 0.002
  # 最终学习率（lr0 * lrf）
  lrf: 0.01
  # 预热轮数
  warmup_epochs: 3.0
  # 早停耐心值（验证指标不改善的轮数）
  patience: 100
  # Dropout 率（小样本中防过拟合很有效）
  dropout: 0.05
  # 损失权重（小目标检测：降低分类损失，注重定位精度）
  loss:
    cls: 0.3   # 分类损失权重（从默认 0.5 降低）
    box: 7.5   # 边界框损失权重
    dfl: 1.5   # Distribution Focal Loss 权重
  # Mosaic 增强（随机拼接 4 张图，小样本检测的神技）
  mosaic: 1.0
  # Copy-paste 增强（将目标复制粘贴到其他图像上）
  copy_paste: 0.2
  # Mixup 增强（轻微混合增强，提高泛化）
  mixup: 0.05
  # 训练后期关闭 mosaic 的轮数（稳定检测）
  close_mosaic: 20

# 数据增强参数
augmentation:
  # HSV 色调增强
  hsv_h: 0.02
  hsv_s: 0.7
  hsv_v: 0.5
  # 旋转角度（度）
  degrees: 5
  # 缩放比例
  scale: 0.5
  # 平移比例
  translate: 0.15
  # 水平翻转概率
  fliplr: 0.2
  # 亮度增强（小地图常受亮度影响）
  brightness: 0.2
  # 对比度增强
  contrast: 0.2
  # 模糊增强（录屏时可能有模糊）
  blur: 0.1

# 数据集配置
dataset:
  # 直接指定源数据路径（配置文件掌控路径）
  # 如果指定了 source_images 和 source_labels，则优先使用这些路径
  # 否则使用 source_dir/images 和 source_dir/labels
  source_images: "C:/Users/11601/project/wot_ai/data/images"
  source_labels: "C:/Users/11601/project/wot_ai/data/labels"
  # 数据集根目录（当 source_images 和 source_labels 未指定时使用）
  # source_dir: "C:/data/minimap_masks"
  # 输出数据集目录（使用统一路径，相对于 data/datasets/processed/minimap）
  output_dir: "data/datasets/processed/minimap"
  # 训练集比例
  train_ratio: 0.8
  # 随机种子（用于可重复分割）
  random_seed: 42

# 类别定义（与 minimap_detector.py 保持一致）
classes:
  - enemy_flag        # 0: 敌军基地
  - self_arrow        # 1: 自己箭头

# 输出配置
output:
  # 项目名称（使用统一路径，相对于 data/models/training/minimap）
  project: "data/models/training/minimap"
  # 实验名称
  name: "exp_minimap"
  # 是否保存训练过程
  save: true
  # 保存周期（每 N 个 epoch 保存一次）
  save_period: 10
  # 是否进行验证
  val: true
  # 验证阶段置信度阈值（输出更多检测结果）
  val_conf_threshold: 0.001
