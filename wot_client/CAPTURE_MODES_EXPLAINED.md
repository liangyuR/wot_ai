# 捕获模式说明

## 🎮 游戏捕获的特殊性

### 为什么窗口捕获会得到黑屏？

现代游戏（包括《坦克世界》）使用**硬件加速渲染**：
- DirectX
- OpenGL  
- Vulkan

这些技术将画面直接渲染到显卡，绕过了 Windows 的窗口系统。

**结果**：Windows GDI 窗口捕获 API 只能看到"窗口容器"，内容是黑色的。

## 📊 两种捕获模式对比

| 特性 | Window 模式 | Fullscreen 模式 |
|------|------------|----------------|
| **普通程序** | ✅ 完美 | ✅ 可用 |
| **硬件加速程序** | ❌ 黑屏 | ✅ 可用 |
| **游戏（DirectX/OpenGL）** | ❌ 黑屏 | ✅ 可用 |
| **自动跟随窗口** | ✅ 是 | ❌ 否 |
| **捕获范围** | 仅窗口 | 整个屏幕 |
| **性能** | 中等 | 最好 |

## 🎯 使用建议

### 测试普通程序
```bash
# 适用于：记事本、浏览器（关闭硬件加速）、Office 等
python record_main.py --mode window --window-title "程序标题"
```

### 录制游戏
```bash
# 适用于：坦克世界、其他游戏
python record_main.py --mode fullscreen --fps 30
```

**重要**：录制游戏时：
1. 将游戏设置为**窗口化全屏**或**全屏**模式
2. 确保游戏窗口占满整个屏幕
3. 使用 **fullscreen 模式**捕获

## 🔧 针对不同情况的配置

### 情况 1: 测试开发（普通程序）

```yaml
capture:
  mode: "window"
  window:
    window_title: "测试程序"
```

### 情况 2: 游戏录制（坦克世界）

```yaml
capture:
  mode: "fullscreen"
  fullscreen:
    width: 1920
    height: 1080
  fps: 30
```

### 情况 3: 浏览器程序

**选项 A**: 关闭硬件加速，使用窗口模式
1. Chrome 设置 → 系统 → 关闭"使用硬件加速"
2. 重启浏览器
3. 使用 window 模式

**选项 B**: 使用全屏模式
```bash
python record_main.py --mode fullscreen
```

## 🛠️ 故障排查

### 问题：录制的视频是黑色的

**症状**：
```
[调试] 帧信息: mean=0.50, max=10, min=0
```

**原因**：捕获到的是黑屏（硬件加速程序）

**解决方法**：
```bash
# 改用全屏模式
python record_main.py --mode fullscreen
```

### 问题：全屏模式捕获了不需要的内容

**症状**：视频中包含任务栏、其他窗口

**解决方法**：
1. 将游戏/程序设置为全屏或窗口化全屏
2. 隐藏任务栏（自动隐藏）
3. 关闭其他窗口
4. 使用单显示器

### 问题：如何只捕获游戏内容？

**方法 1**: 后期裁剪
录制后使用视频编辑软件裁剪掉不需要的部分。

**方法 2**: 调整游戏分辨率
让游戏分辨率等于屏幕分辨率，设置为窗口化全屏。

**方法 3**: 使用专业工具
- OBS Studio (Game Capture)
- NVIDIA ShadowPlay
- AMD ReLive

## 💡 最佳实践

### 对于《坦克世界》AI 训练

1. **游戏设置**
   - 显示模式：窗口化全屏
   - 分辨率：1920x1080（与训练数据一致）
   - 图形质量：根据性能调整

2. **录制设置**
   ```bash
   python record_main.py --mode fullscreen --fps 30
   ```

3. **环境准备**
   - 单显示器或主显示器
   - 隐藏任务栏
   - 关闭通知
   - 关闭其他程序

4. **录制流程**
   ```bash
   # 1. 启动游戏，进入战斗
   # 2. 运行录制工具
   python record_main.py --mode fullscreen
   
   # 3. 按 Enter 开始
   # 4. 正常游戏（至少 30 秒）
   # 5. 按 ESC 停止
   ```

## 🔬 技术细节

### Window 模式实现
使用 Windows API：
- `GetWindowRect` - 获取窗口位置
- `BitBlt` - 位图传输
- 只能捕获 GDI 渲染的内容

### Fullscreen 模式实现
使用屏幕捕获 API：
- Desktop Duplication API（C++ 版本）
- mss（Python fallback）
- 可以捕获所有内容，包括硬件加速

### 为什么不能捕获 DirectX？
DirectX 使用**独占模式**直接访问显卡：
```
游戏 → DirectX → 显卡 → 显示器
      ↑ (绕过 Windows 窗口系统)
```

要捕获需要：
- 钩子（Hook）技术
- 或屏幕捕获（捕获最终输出）

## 📚 相关资源

- [窗口捕获指南](WINDOW_CAPTURE_GUIDE.md)
- [快速开始](QUICKSTART_RECORDING.md)
- [故障排查](TROUBLESHOOTING.md)

## ❓ 常见问题

**Q: 为什么我的浏览器可以用窗口模式？**  
A: 浏览器默认启用了硬件加速，需要在设置中关闭。关闭后就可以用窗口模式。

**Q: 窗口模式有什么优势？**  
A: 自动跟随窗口、只捕获目标内容、支持多任务。但不适合游戏。

**Q: 全屏模式会影响性能吗？**  
A: 全屏模式性能最好，因为分辨率固定且使用优化的 API。

**Q: 可以同时录制多个游戏吗？**  
A: 全屏模式一次只能录制一个屏幕。窗口模式理论上可以，但游戏通常不支持。

**Q: 如何提高录制质量？**  
A: 
1. 提高 FPS（--fps 30 或 60）
2. 使用 C++ 模块（更快更稳定）
3. 确保游戏流畅运行
4. 使用高质量编解码器（XVID）

