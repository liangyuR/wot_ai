# æ•…éšœæ’æŸ¥æŒ‡å—

## é—®é¢˜ï¼šå½•åˆ¶ç›®å½•ä¸ºç©º

### ç—‡çŠ¶
è¿è¡Œå½•åˆ¶åï¼Œ`data/recordings/recording_YYYYMMDD_HHMMSS/` ç›®å½•å­˜åœ¨ä½†ä¸ºç©ºï¼Œæ²¡æœ‰ `gameplay.mp4` å’Œ `actions.json` æ–‡ä»¶ã€‚

### å¯èƒ½åŸå› 

#### 1. å½•åˆ¶æ—¶é—´å¤ªçŸ­
**é—®é¢˜**: æŒ‰ Enter å¼€å§‹å½•åˆ¶åç«‹å³æŒ‰ ESC åœæ­¢ï¼Œæ²¡æœ‰æ•è·åˆ°ä»»ä½•å¸§ã€‚

**è§£å†³æ–¹æ³•**:
- è‡³å°‘å½•åˆ¶ 3-5 ç§’åå†åœæ­¢
- ç­‰å¾…çœ‹åˆ° "å½•åˆ¶ä¸­..." çš„æ—¥å¿—ä¿¡æ¯

#### 2. C++ æ¨¡å—æœªç¼–è¯‘æˆ–åŠ è½½å¤±è´¥
**é—®é¢˜**: C++ ç»‘å®šï¼ˆ`cpp_bindings.pyd`ï¼‰ä¸å­˜åœ¨æˆ–æ— æ³•åŠ è½½ã€‚

**è§£å†³æ–¹æ³•**:
```bash
# 1. æ£€æŸ¥ C++ æ¨¡å—æ˜¯å¦å­˜åœ¨
dir cpp_bindings\cpp_bindings.pyd

# 2. å¦‚æœä¸å­˜åœ¨ï¼Œç¼–è¯‘ C++ æ¨¡å—
cd ..
build_xmake.bat

# 3. è¿è¡Œè¯Šæ–­å·¥å…·
cd wot_client
python test_capture.py
```

#### 3. Python fallback ä¾èµ–æœªå®‰è£…
**é—®é¢˜**: C++ ä¸å¯ç”¨æ—¶ï¼ŒPython fallbackï¼ˆmssã€pynputï¼‰ä¹Ÿæœªå®‰è£…ã€‚

**è§£å†³æ–¹æ³•**:
```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# æˆ–æ‰‹åŠ¨å®‰è£…
pip install mss pynput opencv-python numpy loguru
```

#### 4. å±å¹•æ•è·æƒé™ä¸è¶³
**é—®é¢˜**: Windows å±å¹•æ•è· API è¢«é˜»æ­¢ï¼ˆå¦‚æŸäº›æ¸¸æˆåå¤–æŒ‚ä¿æŠ¤ï¼‰ã€‚

**è§£å†³æ–¹æ³•**:
- ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ
- æ£€æŸ¥æ¸¸æˆçª—å£æ¨¡å¼ï¼ˆå…¨å± vs çª—å£åŒ–ï¼‰
- å°è¯•ä½¿ç”¨çª—å£åŒ–å…¨å±æ¨¡å¼

#### 5. OpenCV VideoWriter å¤±è´¥
**é—®é¢˜**: è§†é¢‘å†™å…¥å™¨æ— æ³•åˆ›å»ºæˆ–å†™å…¥å¤±è´¥ã€‚

**è§£å†³æ–¹æ³•**:
```bash
# é‡æ–°å®‰è£… OpenCV
pip uninstall opencv-python
pip install opencv-python

# æ£€æŸ¥ç£ç›˜ç©ºé—´
# å½•åˆ¶ä¼šå ç”¨å¤§é‡ç©ºé—´ï¼š30ç§’@30fps â‰ˆ 500MB+
```

## è¯Šæ–­æ­¥éª¤

### æ­¥éª¤ 1: è¿è¡Œç³»ç»Ÿè¯Šæ–­
```bash
cd wot_client
venv\Scripts\activate
python test_capture.py
```

æ£€æŸ¥è¾“å‡ºï¼š
- âœ“ è¡¨ç¤ºæµ‹è¯•é€šè¿‡
- âœ— è¡¨ç¤ºæµ‹è¯•å¤±è´¥ï¼ŒæŸ¥çœ‹é”™è¯¯ä¿¡æ¯

### æ­¥éª¤ 2: æµ‹è¯•å±å¹•æ•è·
```bash
python record_main.py --test
```

å¦‚æœæµ‹è¯•é€šè¿‡ï¼Œè¯´æ˜æ•è·åŠŸèƒ½æ­£å¸¸ã€‚

### æ­¥éª¤ 3: å¯ç”¨è°ƒè¯•æ—¥å¿—
ç¼–è¾‘ `record_gameplay.py`ï¼Œä¿®æ”¹æ—¥å¿—çº§åˆ«ï¼š

```python
# åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ 
import logging
logging.basicConfig(level=logging.DEBUG)
```

æˆ–ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼š
```bash
set LOGURU_LEVEL=DEBUG
python record_main.py
```

### æ­¥éª¤ 4: æ£€æŸ¥å®æ—¶æ—¥å¿—
æ­£å¸¸å½•åˆ¶æ—¶åº”è¯¥çœ‹åˆ°ï¼š
```
åˆå§‹åŒ–å±å¹•æ•è·æ¨¡å—...
âœ“ C++ å±å¹•æ•è·æ¨¡å—åˆå§‹åŒ–æˆåŠŸ  # æˆ– Python fallback
åˆå§‹åŒ–è¾“å…¥ç›‘å¬å™¨...
âœ“ è¾“å…¥ç›‘å¬å™¨åˆå§‹åŒ–æˆåŠŸ
========================================
ğŸ¬ å½•åˆ¶å¼€å§‹ï¼
  - æŒ‰ ESC é”®åœæ­¢å½•åˆ¶
  - ç›®æ ‡ FPS: 30
  - C++ åŠ é€Ÿ: å¯ç”¨
========================================
å½•åˆ¶ä¸­... å¸§æ•°: 150, æ—¶é•¿: 5.0s, FPS: 30.0
```

å¦‚æœçœ‹åˆ°é”™è¯¯ä¿¡æ¯ï¼Œæ ¹æ®æç¤ºæ“ä½œã€‚

## å¸¸è§é”™è¯¯ä¿¡æ¯

### `ImportError: DLL load failed`
**åŸå› **: ç¼ºå°‘ MSVC è¿è¡Œæ—¶æˆ–ä¾èµ–åº“

**è§£å†³**:
1. å®‰è£… [Visual C++ Redistributable](https://aka.ms/vs/17/release/vc_redist.x64.exe)
2. é‡æ–°ç¼–è¯‘ C++ æ¨¡å—

### `ModuleNotFoundError: No module named 'mss'`
**åŸå› **: Python fallback ä¾èµ–æœªå®‰è£…

**è§£å†³**:
```bash
pip install mss pynput
```

### `RuntimeError: Failed to open video writer`
**åŸå› **: OpenCV æ— æ³•åˆ›å»ºè§†é¢‘æ–‡ä»¶

**è§£å†³**:
1. æ£€æŸ¥ç£ç›˜ç©ºé—´
2. æ£€æŸ¥è¾“å‡ºç›®å½•æƒé™
3. å°è¯•ä¸åŒçš„ç¼–è§£ç å™¨ï¼ˆä¿®æ”¹ä»£ç ä¸­çš„ `fourcc`ï¼‰

### `âŒ å½•åˆ¶å¤±è´¥ï¼šæ²¡æœ‰æ•è·åˆ°ä»»ä½•å¸§ï¼`
**åŸå› **: è§ä¸Šè¿°"å¯èƒ½åŸå› "éƒ¨åˆ†

**è§£å†³**: æŒ‰ç…§ä¸Šé¢çš„è¯Šæ–­æ­¥éª¤é€ä¸€æ’æŸ¥

## æ€§èƒ½é—®é¢˜

### å½•åˆ¶å¡é¡¿æˆ– FPS ä½
1. **é™ä½å½•åˆ¶åˆ†è¾¨ç‡**: ä¿®æ”¹ `record_gameplay.py` ä¸­çš„ `1920, 1080`
2. **é™ä½ FPS**: ä½¿ç”¨ `--fps 15` æˆ– `--fps 20`
3. **ç¡®ä¿ä½¿ç”¨ C++ æ¨¡å—**: Python fallback æ€§èƒ½è¾ƒä½
4. **å…³é—­å…¶ä»–åº”ç”¨**: å‡å°‘ç³»ç»Ÿè´Ÿè½½

### å†…å­˜ä¸è¶³
å½•åˆ¶æ—¶é—´è¿‡é•¿ä¼šå ç”¨å¤§é‡å†…å­˜ï¼ˆæ‰€æœ‰å¸§éƒ½å­˜åœ¨å†…å­˜ä¸­ï¼‰ã€‚

**è§£å†³**:
- åˆ†æ®µå½•åˆ¶ï¼Œæ¯æ¬¡ä¸è¶…è¿‡ 1-2 åˆ†é’Ÿ
- æˆ–ä¿®æ”¹ä»£ç ï¼Œæ”¹ä¸ºå®æ—¶å†™å…¥è§†é¢‘ï¼ˆæ›´å¤æ‚ï¼‰

## ä»ç„¶æ— æ³•è§£å†³ï¼Ÿ

1. **æŸ¥çœ‹å®Œæ•´æ—¥å¿—**: ä¿å­˜æ§åˆ¶å°æ‰€æœ‰è¾“å‡º
2. **æä¾›ç¯å¢ƒä¿¡æ¯**:
   ```bash
   python test_capture.py > diagnostic.txt 2>&1
   ```
3. **æ£€æŸ¥æ–‡ä»¶æƒé™**: ç¡®ä¿å¯¹ `data/recordings/` æœ‰å†™æƒé™
4. **æ€æ¯’è½¯ä»¶**: æŸäº›æ€æ¯’è½¯ä»¶ä¼šé˜»æ­¢å±å¹•æ•è·æˆ–è¾“å…¥æ¨¡æ‹Ÿ

## è°ƒè¯•æŠ€å·§

### æµ‹è¯•æœ€å°åŒ–ä»£ç 
åˆ›å»ºä¸€ä¸ªç®€å•çš„æµ‹è¯•è„šæœ¬ï¼š

```python
# test_minimal.py
import sys
sys.path.append('.')

try:
    from cpp_bindings import ScreenCapture
    sc = ScreenCapture(1920, 1080)
    buffer = sc.Capture()
    print(f"âœ“ æ•è·æˆåŠŸ: {len(buffer)} å­—èŠ‚")
except Exception as e:
    print(f"âœ— å¤±è´¥: {e}")
    import traceback
    traceback.print_exc()
```

### é€æ­¥éªŒè¯
1. å¯¼å…¥æ¨¡å—
2. åˆå§‹åŒ–æ•è·å™¨
3. æ•è·ä¸€å¸§
4. ä¿å­˜ä¸ºå›¾ç‰‡
5. å¾ªç¯æ•è·
6. å†™å…¥è§†é¢‘

åœ¨æ¯ä¸€æ­¥æ£€æŸ¥æ˜¯å¦æˆåŠŸã€‚

## æˆåŠŸæ ‡å¿—

å½•åˆ¶æˆåŠŸååº”è¯¥çœ‹åˆ°ï¼š
```
========================================
âœ“ å½•åˆ¶æˆåŠŸä¿å­˜åˆ°: data/recordings/recording_20251025_154556
  - æ€»å¸§æ•°: 150
  - æ—¶é•¿: 5.00s
  - å¹³å‡ FPS: 30.00
========================================
```

ç›®å½•ç»“æ„ï¼š
```
data/recordings/recording_20251025_154556/
â”œâ”€â”€ gameplay.mp4      # è§†é¢‘æ–‡ä»¶ï¼ˆåº”æœ‰å‡ ç™¾ KB åˆ° MBï¼‰
â””â”€â”€ actions.json      # æ“ä½œè®°å½•ï¼ˆåŒ…å«æŒ‰é”®ã€é¼ æ ‡æ•°æ®ï¼‰
```

